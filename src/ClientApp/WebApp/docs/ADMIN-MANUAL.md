# IAM 系统管理员操作手册

## 目录

1. [管理员职责](#管理员职责)
2. [用户管理](#用户管理)
3. [角色与权限管理](#角色与权限管理)
4. [组织管理](#组织管理)
5. [客户端管理](#客户端管理)
6. [作用域管理](#作用域管理)
7. [安全审计](#安全审计)
8. [系统设置](#系统设置)
9. [故障排查](#故障排查)

## 管理员职责

作为 IAM 系统管理员，您需要负责：

- 用户账户的创建、修改和删除
- 角色和权限的分配与管理
- 组织架构的维护
- OAuth 客户端的配置
- 安全策略的制定和执行
- 系统日志和审计的监控
- 用户问题的处理和支持

## 用户管理

### 访问用户管理

1. 登录管理后台
2. 点击侧边栏的"用户管理"
3. 进入用户列表页面

### 创建新用户

1. 点击"添加用户"按钮
2. 填写必填信息：
   - **用户名**：唯一标识符
   - **邮箱**：用于通知和密码重置
   - **密码**：初始密码（用户首次登录后应修改）
   - **手机号**：可选，用于短信验证
3. 选择用户角色
4. 设置用户所属组织
5. 点击"保存"

### 编辑用户信息

1. 在用户列表中找到目标用户
2. 点击"编辑"按钮或用户名
3. 修改需要更新的信息
4. 点击"保存"

### 用户状态管理

#### 锁定用户

1. 找到目标用户
2. 点击"锁定"按钮
3. 确认操作
4. 用户将无法登录直至解锁

#### 解锁用户

1. 找到被锁定的用户
2. 点击"解锁"按钮
3. 确认操作

#### 重置密码

1. 找到目标用户
2. 点击"重置密码"
3. 选择发送重置链接到邮箱或设置临时密码
4. 通知用户

### 删除用户

1. 找到目标用户
2. 点击"删除"按钮
3. 选择软删除或硬删除
   - **软删除**：标记为已删除，数据保留
   - **硬删除**：永久删除，不可恢复
4. 确认操作

### 批量操作

#### 批量导入用户

1. 准备 CSV 文件，包含必要字段
2. 点击"批量导入"
3. 上传文件
4. 检查预览
5. 确认导入

#### 批量导出用户

1. 设置筛选条件
2. 点击"导出"按钮
3. 选择导出格式（CSV/Excel）
4. 下载文件

## 角色与权限管理

### 角色管理

#### 创建角色

1. 进入"角色管理"
2. 点击"添加角色"
3. 填写角色信息：
   - **角色名称**：描述性名称
   - **角色描述**：角色用途说明
4. 点击"保存"

#### 分配权限

1. 在角色列表中找到目标角色
2. 点击"权限管理"
3. 在权限树中勾选需要的权限：
   - **用户管理**：read, create, update, delete, manage
   - **角色管理**：read, create, update, delete, assign
   - **组织管理**：read, create, update, delete, manage-members
   - **客户端管理**：read, create, update, delete, manage-secrets
   - **作用域管理**：read, create, update, delete
   - **审计日志**：read, export
   - **系统设置**：read, configure, manage
4. 点击"保存"

#### 删除角色

1. 找到目标角色
2. 确认该角色未被分配给任何用户
3. 点击"删除"
4. 确认操作

### 用户角色分配

#### 为用户分配角色

1. 进入用户详情页
2. 在"角色"部分点击"编辑"
3. 勾选需要分配的角色
4. 点击"保存"

#### 移除用户角色

1. 进入用户详情页
2. 在"角色"列表中找到要移除的角色
3. 点击"移除"
4. 确认操作

### 权限继承

- 用户可以拥有多个角色
- 最终权限是所有角色权限的并集
- 建议遵循最小权限原则

## 组织管理

### 创建组织

1. 进入"组织管理"
2. 点击"添加组织"
3. 填写组织信息：
   - **组织名称**
   - **父组织**：可选，创建子组织
   - **描述**
4. 点击"保存"

### 组织树结构

系统支持多层级组织架构：

```
公司
├── 技术部
│   ├── 开发组
│   └── 测试组
├── 产品部
└── 运营部
```

### 管理组织成员

#### 添加成员

1. 选择目标组织
2. 点击"添加成员"
3. 搜索并选择用户
4. 点击"确认"

#### 移除成员

1. 在组织成员列表中找到目标用户
2. 点击"移除"
3. 确认操作

### 删除组织

1. 确认组织下没有子组织
2. 移除或转移所有成员
3. 点击"删除"
4. 确认操作

## 客户端管理

### 创建客户端

1. 进入"客户端管理"
2. 点击"添加客户端"
3. 填写客户端信息：
   - **客户端 ID**：唯一标识符
   - **显示名称**：友好名称
   - **客户端类型**：
     - Confidential（服务器端应用）
     - Public（单页应用、移动应用）
   - **密钥**：仅 Confidential 类型需要
4. 配置授权设置：
   - **授权类型**：
     - authorization_code（授权码）
     - client_credentials（客户端凭证）
     - refresh_token（刷新令牌）
     - device_code（设备码）
   - **重定向 URI**：授权后的回调地址
   - **作用域**：客户端可请求的作用域
5. 高级选项：
   - **需要 PKCE**：增强安全性
   - **需要同意**：用户授权时显示同意页面
   - **令牌有效期**：Access Token 生命周期
   - **刷新令牌有效期**
6. 点击"保存"

### 管理客户端密钥

#### 查看密钥

1. 进入客户端详情
2. 点击"查看密钥"
3. 密钥仅在创建时显示一次，请妥善保存

#### 轮换密钥

1. 进入客户端详情
2. 点击"轮换密钥"
3. 生成新密钥
4. 旧密钥将在指定时间后失效
5. 更新应用程序配置

### 配置重定向 URI

1. 进入客户端编辑页面
2. 在"重定向 URI"部分添加或删除 URI
3. 确保 URI 使用 HTTPS（生产环境）
4. 支持多个 URI
5. 点击"保存"

### 分配作用域

1. 进入客户端详情
2. 点击"作用域管理"
3. 勾选允许的作用域
4. 点击"保存"

### 查看客户端授权记录

1. 进入客户端详情
2. 选择"授权记录"标签
3. 查看所有授权历史

## 作用域管理

### 创建作用域

1. 进入"作用域管理"
2. 点击"添加作用域"
3. 填写信息：
   - **作用域名称**：如 `users.read`
   - **显示名称**：用户友好的名称
   - **描述**：作用域用途说明
   - **是否必需**：用户无法取消勾选
   - **是否强调**：在同意页面突出显示
4. 点击"保存"

### 内置作用域

系统包含以下内置作用域：

- **openid**：OpenID Connect 基本身份信息
- **profile**：用户个人资料
- **email**：邮箱地址
- **phone**：手机号码
- **offline_access**：刷新令牌

### 自定义作用域

根据业务需求创建自定义作用域，建议遵循命名规范：

- 格式：`resource.action`
- 示例：
  - `users.read`
  - `users.write`
  - `orders.manage`
  - `reports.export`

## 安全审计

### 查看审计日志

1. 进入"安全中心" > "审计日志"
2. 使用筛选条件：
   - **时间范围**
   - **用户**
   - **事件类型**：
     - 用户登录/登出
     - 权限变更
     - 配置修改
     - 数据访问
   - **操作结果**：成功/失败
3. 查看详细日志

### 导出审计日志

1. 设置筛选条件
2. 点击"导出"
3. 选择格式（CSV/JSON）
4. 下载文件

### 会话监控

#### 查看活动会话

1. 进入"安全中心" > "活动会话"
2. 查看所有在线用户
3. 显示信息：
   - 用户名
   - 登录时间
   - IP 地址
   - 设备信息

#### 强制注销

1. 在会话列表中找到目标会话
2. 点击"强制注销"
3. 确认操作
4. 用户将立即退出登录

### 安全策略配置

#### 密码策略

1. 进入"系统设置" > "安全策略"
2. 配置密码要求：
   - 最小长度
   - 复杂度要求
   - 历史密码检查
   - 密码有效期
3. 点击"保存"

#### 账户锁定策略

1. 设置失败登录次数阈值
2. 配置锁定持续时间
3. 启用/禁用自动解锁
4. 点击"保存"

#### 会话策略

1. 配置会话超时时间
2. 设置绝对超时时间
3. 启用/禁用"记住我"功能
4. 点击"保存"

## 系统设置

### 全局设置

1. 进入"系统设置"
2. 配置：
   - **系统名称**
   - **Logo**
   - **主题色**
   - **默认语言**
   - **时区**
3. 点击"保存"

### 邮件配置

1. 进入"系统设置" > "邮件"
2. 配置 SMTP 服务器：
   - **服务器地址**
   - **端口**
   - **用户名/密码**
   - **启用 SSL/TLS**
3. 配置邮件模板
4. 发送测试邮件
5. 点击"保存"

### 通知设置

1. 配置通知规则：
   - 用户注册
   - 密码重置
   - 异常登录
   - 权限变更
2. 选择通知方式：
   - 邮件
   - 短信
   - 系统通知
3. 点击"保存"

## 故障排查

### 用户无法登录

**检查清单**：
1. 验证用户账户是否存在
2. 检查账户是否被锁定
3. 确认密码是否正确
4. 检查 MFA 配置
5. 查看审计日志中的登录失败记录

### 客户端认证失败

**检查清单**：
1. 验证客户端 ID 和密钥
2. 检查重定向 URI 是否匹配
3. 确认授权类型配置正确
4. 验证作用域是否允许
5. 检查 PKCE 配置（如需要）

### 权限问题

**检查清单**：
1. 验证用户的角色分配
2. 检查角色的权限配置
3. 确认权限继承关系
4. 查看审计日志

### 性能问题

**优化建议**：
1. 定期清理过期令牌
2. 归档历史审计日志
3. 优化数据库索引
4. 监控系统资源使用

## 最佳实践

### 安全建议

1. **最小权限原则**：只授予必要的权限
2. **定期审计**：每月审查用户权限和角色分配
3. **强制 PKCE**：所有公共客户端启用 PKCE
4. **密钥轮换**：定期轮换客户端密钥
5. **监控异常**：关注失败的登录尝试

### 运维建议

1. **备份策略**：定期备份数据库和配置
2. **日志保留**：至少保留 90 天的审计日志
3. **文档维护**：记录所有配置变更
4. **权限审查**：季度权限审查和清理
5. **用户培训**：定期进行安全意识培训

### 命名规范

- **用户名**：小写字母、数字、下划线
- **角色名**：大写开头，描述性名称
- **客户端 ID**：小写字母、连字符
- **作用域**：`resource.action` 格式

## 常见管理任务

### 新员工入职

1. 创建用户账户
2. 分配到相应组织
3. 授予适当角色
4. 发送欢迎邮件（含初始密码）
5. 记录操作日志

### 员工离职

1. 禁用用户账户
2. 撤销所有授权
3. 强制注销所有会话
4. 转移重要数据（如需要）
5. 软删除账户
6. 记录操作日志

### 定期维护

**每日任务**：
- 检查系统状态
- 查看异常登录
- 处理用户支持请求

**每周任务**：
- 审查审计日志
- 检查会话异常
- 更新文档

**每月任务**：
- 权限审计
- 清理过期数据
- 性能优化
- 安全策略审查

## 联系技术支持

如需技术支持，请提供以下信息：

- 问题描述
- 复现步骤
- 错误消息
- 相关日志
- 系统版本

**支持渠道**：
- 邮箱：admin-support@example.com
- 内部工单系统
- 紧急热线：+86 XXX-XXXX-XXXX

---

**版本**：v1.0  
**更新日期**：2025-10-28  
**适用系统版本**：IAM v1.0+  
**维护者**：IAM 技术团队
