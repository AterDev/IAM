<div class="p-2">
  <div class="d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-1">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h2 class="my-1">{{ 'client.clientDetail' | translate }}</h2>
    </div>
    <div class="d-flex gap-1">
      <button matButton="filled" (click)="openEditDialog()">
        <mat-icon>edit</mat-icon>
        {{ 'common.edit' | translate }}
      </button>
      <button matButton="filled" (click)="rotateSecret()">
        <mat-icon>refresh</mat-icon>
        {{ 'client.rotateSecret' | translate }}
      </button>
      <button matButton="filled" (click)="deleteClient()">
        <mat-icon>delete</mat-icon>
        {{ 'common.delete' | translate }}
      </button>
    </div>
  </div>

  <app-loading *ngIf="isLoading()" [diameter]="50"></app-loading>

  @if (!isLoading() && client()) {
  <mat-tab-group>
    <mat-tab [label]="'client.basicInfo' | translate">
      <div class="d-flex flex-column gap-2">
        <mat-card>
          <mat-card-content>
            <div class="row">
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.clientId' | translate }}:</label>
                <span class="text-primary cursor-pointer d-flex align-items-center gap-2" (click)="copyClientId()"
                  role="button">
                  {{ client()!.clientId }}
                  <mat-icon class="small">content_copy</mat-icon>
                </span>
              </div>
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.displayName' | translate }}:</label>
                <span>{{ client()!.displayName }}</span>
              </div>
              @if (client()!.description) {
              <div class="col-12 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.description' | translate }}:</label>
                <span>{{ client()!.description }}</span>
              </div>
              }
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.type' | translate }}:</label>
                <span>
                  <mat-chip>{{ client()!.type }}</mat-chip>
                </span>
              </div>
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.applicationType' | translate }}:</label>
                <span>
                  <mat-chip>{{ client()!.applicationType }}</mat-chip>
                </span>
              </div>
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.consentType' | translate }}:</label>
                <span>{{ client()!.consentType || '-' }}</span>
              </div>
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'client.requirePkce' | translate }}:</label>
                <span>
                  <mat-icon [style.color]="client()!.requirePkce ? '#4caf50' : '#f44336'">
                    {{ client()!.requirePkce ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                </span>
              </div>
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'common.createdTime' | translate }}:</label>
                <span>{{ client()!.createdTime | date:'yyyy-MM-dd HH:mm:ss' }}</span>
              </div>
              <div class="col-md-6 mb-4">
                <label class="fw-500 d-block mb-2">{{ 'common.updatedTime' | translate }}:</label>
                <span>{{ client()!.updatedTime | date:'yyyy-MM-dd HH:mm:ss' }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ 'client.redirectUris' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (client()!.redirectUris.length > 0) {
            <mat-chip-set>
              @for (uri of client()!.redirectUris; track uri) {
              <mat-chip>{{ uri }}</mat-chip>
              }
            </mat-chip-set>
            }
            @if (client()!.redirectUris.length === 0) {
            <p class="text-center text-muted py-5">
              {{ 'client.noRedirectUris' | translate }}
            </p>
            }
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ 'client.postLogoutRedirectUris' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (client()!.postLogoutRedirectUris.length > 0) {
            <mat-chip-set>
              @for (uri of client()!.postLogoutRedirectUris; track uri) {
              <mat-chip>{{ uri }}</mat-chip>
              }
            </mat-chip-set>
            }
            @if (client()!.postLogoutRedirectUris.length === 0) {
            <p class="text-center text-muted py-5">
              {{ 'client.noPostLogoutRedirectUris' | translate }}
            </p>
            }
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ 'client.scopes' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (client()!.scopes.length > 0) {
            <mat-chip-set>
              @for (scope of client()!.scopes; track scope) {
              <mat-chip>{{ scope }}</mat-chip>
              }
            </mat-chip-set>
            }
            @if (client()!.scopes.length === 0) {
            <p class="text-center text-muted py-5">
              {{ 'client.noScopes' | translate }}
            </p>
            }
          </mat-card-content>
        </mat-card>
      </div>

    </mat-tab>

    <mat-tab [label]="'client.authorizations' | translate">
      <mat-card>
        <mat-card-content>
          @if (isLoadingAuthorizations()) {
          <app-loading></app-loading>
          }

          @if (!isLoadingAuthorizations()) {
          <div class="table-responsive">
            <table mat-table [dataSource]="authorizations()" class="w-100">
              <ng-container matColumnDef="subjectId">
                <th mat-header-cell *matHeaderCellDef>{{ 'client.subjectId' | translate }}</th>
                <td mat-cell *matCellDef="let auth">{{ auth.subjectId }}</td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>{{ 'client.status' | translate }}</th>
                <td mat-cell *matCellDef="let auth">
                  <mat-chip>{{ auth.status }}</mat-chip>
                </td>
              </ng-container>

              <ng-container matColumnDef="creationDate">
                <th mat-header-cell *matHeaderCellDef>{{ 'client.creationDate' | translate }}</th>
                <td mat-cell *matCellDef="let auth">{{ auth.creationDate | date:'yyyy-MM-dd HH:mm:ss' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="authDisplayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: authDisplayedColumns;"></tr>
            </table>
          </div>
          }

          @if (!isLoadingAuthorizations() && authorizations().length === 0) {
          <p class="text-center text-muted py-5">
            {{ 'client.noAuthorizations' | translate }}
          </p>
          }
        </mat-card-content>
      </mat-card>
    </mat-tab>
  </mat-tab-group>
  }
</div>